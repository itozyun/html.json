var aa = {xml:!0, svg:!0, math:!0}, x = {async:!0, autofocus:!0, checked:!0, compact:!0, declare:!0, defer:!0, disabled:!0, draggable:!0, hidden:!0, ismap:!0, loop:!0, multiple:!0, nohref:!0, noresize:!0, noshade:!0, novalidate:!0, nowrap:!0, readonly:!0, required:!0, reversed:!0, scoped:!0, selected:!0}, ba = {AREA:!0, BASE:!0, BASEFONT:!0, BR:!0, BGSOUND:!0, COL:!0, COMMAND:!0, FRAME:!0, HR:!0, IMG:!0, INPUT:!0, ISINDEX:!0, KEYGEN:!0, LINK:!0, META:!0, PARAM:!0, SOURCE:!0, TRACK:!0, EMBED:!0, WBR:!0, 
area:!0, base:!0, basefont:!0, br:!0, bgsound:!0, col:!0, command:!0, frame:!0, hr:!0, img:!0, input:!0, isindex:!0, keygen:!0, link:!0, meta:!0, param:!0, source:!0, track:!0, embed:!0, wbr:!0}, B = {CAPTION:{ARTICLE:!0, SECTION:!0, NAV:!0, ASIDE:!0, H1:!0, H2:!0, H3:!0, H4:!0, H5:!0, H6:!0, HEADER:!0, FOOTER:!0, ADDRESS:!0, P:!0, HR:!0, PRE:!0, BLOCKQUOTE:!0, OL:!0, UL:!0, DL:!0, FIGURE:!0, DIV:!0, A:!0, EM:!0, STRONG:!0, SMALL:!0, S:!0, CITE:!0, Q:!0, DFN:!0, ABBR:!0, DATA:!0, TIME:!0, CODE:!0, 
VAR:!0, SAMP:!0, KBD:!0, SUB:!0, SUP:!0, I:!0, B:!0, U:!0, MARK:!0, RUBY:!0, BDI:!0, BDO:!0, SPAN:!0, BR:!0, WBR:!0, INS:!0, DEL:!0, PICTURE:!0, IMG:!0, IFRAME:!0, EMBED:!0, OBJECT:!0, VIDEO:!0, AUDIO:!0, MAP:!0, AREA:!0, math:!0, svg:!0, FORM:!0, LABEL:!0, INPUT:!0, BUTTON:!0, SELECT:!0, DATALIST:!0, TEXTAREA:!0, KEYGEN:!0, OUTPUT:!0, PROGRESS:!0, METER:!0, FIELDSET:!0, DETAILS:!0, DIALOG:!0, SCRIPT:!0, NOSCRIPT:!0, TEMPLATE:!0, CANVAS:!0}, DD:{ARTICLE:!0, SECTION:!0, NAV:!0, ASIDE:!0, H1:!0, H2:!0, 
H3:!0, H4:!0, H5:!0, H6:!0, HEADER:!0, FOOTER:!0, ADDRESS:!0, P:!0, HR:!0, PRE:!0, BLOCKQUOTE:!0, OL:!0, UL:!0, DL:!0, FIGURE:!0, DIV:!0, A:!0, EM:!0, STRONG:!0, SMALL:!0, S:!0, CITE:!0, Q:!0, DFN:!0, ABBR:!0, DATA:!0, TIME:!0, CODE:!0, VAR:!0, SAMP:!0, KBD:!0, SUB:!0, SUP:!0, I:!0, B:!0, U:!0, MARK:!0, RUBY:!0, BDI:!0, BDO:!0, SPAN:!0, BR:!0, WBR:!0, INS:!0, DEL:!0, PICTURE:!0, IMG:!0, IFRAME:!0, EMBED:!0, OBJECT:!0, VIDEO:!0, AUDIO:!0, MAP:!0, AREA:!0, math:!0, svg:!0, TABLE:!0, FORM:!0, LABEL:!0, 
INPUT:!0, BUTTON:!0, SELECT:!0, DATALIST:!0, TEXTAREA:!0, KEYGEN:!0, OUTPUT:!0, PROGRESS:!0, METER:!0, FIELDSET:!0, DETAILS:!0, DIALOG:!0, SCRIPT:!0, NOSCRIPT:!0, TEMPLATE:!0, CANVAS:!0}, DT:{ADDRESS:!0, P:!0, HR:!0, PRE:!0, BLOCKQUOTE:!0, OL:!0, UL:!0, DL:!0, FIGURE:!0, DIV:!0, A:!0, EM:!0, STRONG:!0, SMALL:!0, S:!0, CITE:!0, Q:!0, DFN:!0, ABBR:!0, DATA:!0, TIME:!0, CODE:!0, VAR:!0, SAMP:!0, KBD:!0, SUB:!0, SUP:!0, I:!0, B:!0, U:!0, MARK:!0, RUBY:!0, BDI:!0, BDO:!0, SPAN:!0, BR:!0, WBR:!0, INS:!0, 
DEL:!0, PICTURE:!0, IMG:!0, IFRAME:!0, EMBED:!0, OBJECT:!0, VIDEO:!0, AUDIO:!0, MAP:!0, AREA:!0, math:!0, svg:!0, TABLE:!0, FORM:!0, LABEL:!0, INPUT:!0, BUTTON:!0, SELECT:!0, DATALIST:!0, TEXTAREA:!0, KEYGEN:!0, OUTPUT:!0, PROGRESS:!0, METER:!0, FIELDSET:!0, DETAILS:!0, DIALOG:!0, SCRIPT:!0, NOSCRIPT:!0, TEMPLATE:!0, CANVAS:!0}, P:{A:!0, EM:!0, STRONG:!0, SMALL:!0, S:!0, CITE:!0, Q:!0, DFN:!0, ABBR:!0, DATA:!0, TIME:!0, CODE:!0, VAR:!0, SAMP:!0, KBD:!0, SUB:!0, SUP:!0, I:!0, B:!0, U:!0, MARK:!0, 
RUBY:!0, BDI:!0, BDO:!0, SPAN:!0, BR:!0, WBR:!0, INS:!0, DEL:!0, PICTURE:!0, IMG:!0, IFRAME:!0, EMBED:!0, OBJECT:!0, VIDEO:!0, AUDIO:!0, MAP:!0, AREA:!0, math:!0, svg:!0, LABEL:!0, INPUT:!0, BUTTON:!0, SELECT:!0, DATALIST:!0, TEXTAREA:!0, KEYGEN:!0, OUTPUT:!0, PROGRESS:!0, METER:!0, SCRIPT:!0, NOSCRIPT:!0, TEMPLATE:!0, CANVAS:!0}, HTML:{HEAD:!0, BODY:!0}, HEAD:{TITLE:!0, BASE:!0, BGSOUND:!0, LINK:!0, META:!0, STYLE:!0, SCRIPT:!0, NOSCRIPT:!0, TEMPLATE:!0}, COLGROUP:{COL:!0}, OPTGROUP:{OPTION:!0}, 
OPTION:{}, TBODY:{TR:!0}, TR:{TH:!0, TD:!0}, RBC:{RB:!0, RP:!0, RT:!0}};
B.LI = B.TD = B.DD;
B.TH = B.DT;
B.RB = B.RP = B.RT = B.P;
B.TFOOT = B.THEAD = B.TBODY;
B.RTC = B.RBC;
function C(a, e, d) {
  var f = a, c = G(f), b = 0, g = e(a, null, -1, b / 3), k = [-1, a, c];
  if (Infinity !== g && -Infinity !== g) {
    if (0 < f.length - c) {
      do {
        var t = ++k[b];
        var n = f[t + c];
        if (void 0 === n) {
          if (k.length = b, b -= 3, f = k[b + 1], c = k[b + 2], d && f) {
            t = k[b] + c;
            g = d(f[t], f, t, b / 3 + 1);
            if (Infinity === g) {
              return;
            }
            -Infinity !== g && (-1 >= g || 1 <= g) && (k[b] += g);
          }
        } else {
          g = e(n, f, t + c, b / 3 + 1);
          if (Infinity === g) {
            return;
          }
          if (-Infinity !== g) {
            if (-1 >= g) {
              k[b] += g;
            } else {
              if (1 <= g && (k[b] += g), g = G(n), 0 < n.length - g) {
                b += 3, k[b] = -1, k[b + 1] = f = n, k[b + 2] = c = g;
              } else if (d && f) {
                g = d(n, f, t + c, b / 3 + 1);
                if (Infinity === g) {
                  return;
                }
                -Infinity !== g && (-1 >= g || 1 <= g) && (k[b] += g);
              }
            }
          }
        }
      } while (0 <= b);
    }
    d && d(a, null, -1, 0);
  }
}
;var ca = {HTML:!0, HEAD:!0, BODY:!0, P:!0, DT:!0, DD:!0, LI:!0, OPTION:!0, TBODY:!0, THEAD:!0, TFOOT:!0, TD:!0, TH:!0, TR:!0, RB:!0, RBC:!0, RP:!0, RT:!0, RTC:!0, OPTGROUP:!0, CAPTION:!0, COLGROUP:!0}, da = {A:!0, AUDIO:!0, DEL:!0, INS:!0, MAP:!0, NOSCRIPT:!0, VIDEO:!0}, ia = {H1:!0, H2:!0, H3:!0, H4:!0, H5:!0, H6:!0, ADDRESS:!0, BLOCKQUOTE:!0, DIV:!0, DL:!0, FIELDSET:!0, FORM:!0, HR:!0, LEGEND:!0, MENU:!0, NOSCRIPT:!0, OL:!0, P:!0, PRE:!0, UL:!0, CENTER:!0, DIR:!0, NOFRAMES:!0, MARQUEE:!0}, ja = 
{SCRIPT:!0, STYLE:!0, TEXTAREA:!0, TITLE:!0, PLAINTEXT:!0, XMP:!0, script:!0, style:!0, textarea:!0, title:!0, plaintext:!0, xmp:!0};
function M(a) {
  return !(!a || a.pop !== [].pop);
}
function N(a) {
  return !(!a || "object" !== typeof a);
}
function P(a) {
  return "" + a === a;
}
function R(a) {
  if (P(a) || a === +a) {
    a = 3;
  } else {
    if (M(a)) {
      if (P(a[0])) {
        a = 1;
      } else {
        var e = a[0];
        a = e === +e ? a[0] : -1;
      }
    } else {
      a = -1;
    }
  }
  return a;
}
function ka(a, e, d, f, c) {
  var b;
  if (M(d) && P(d[0])) {
    var g = d[0];
    d = d.slice(1);
    "function" === typeof a ? b = d.length ? a.call(c, g, d) : a.call(c, g) : a[g] && (b = d.length ? a[g].apply(c || a, d) : a[g].call(c || a));
  } else {
    P(d) && ("function" === typeof a ? b = a.call(c, d) : a[d] && (b = a[d].call(c || a)));
  }
  return M(b) ? ka(a, e, b, f, c) : b;
}
function S(a) {
  return a.split("&lt;").join("&amp;lt;").split("&gt;").join("&amp;gt;").split("<").join("&lt;").split(">").join("&gt;");
}
function T(a, e, d) {
  a = S("" + a);
  var f = a.match('"'), c = a.match("'"), b = e ? "'" : '"';
  f && c ? a = e ? b + a.split("'").join("\\'") + b : b + a.split('"').join('\\"') + b : f ? a = "'" + a + "'" : c ? a = e ? b + a.split("'").join("\\'") + b : b + a + b : d || a.match(/[^0-9a-z\.\-]/g) || 72 < a.length ? a = b + a + b : "" === a && (a = b + b);
  return a;
}
function G(a) {
  var e = a[0], d = e === +e ? 2 : 1;
  1 === R(a) || 17 === e ? (a = a[d], d = !M(a) && N(a) ? d + 1 : d) : d = 11 === e ? 1 : 9 === e || 13 === e || 16 === e ? 2 : Infinity;
  return d;
}
function U(a) {
  var e = a.indexOf("#"), d = a.indexOf("."), f = "", c = "";
  e < d ? (f = a.split(".")[1], a = a.split(".")[0], 0 < e && (c = a.split("#")[1], a = a.split("#")[0])) : d < e && (c = a.split("#")[1], a = a.split("#")[0], 0 < d && (f = a.split(".")[1], a = a.split(".")[0]));
  return [a, c, f];
}
function la(a) {
  var e, d;
  C(a, function(f, c, b, g) {
    function k(H, E, v) {
      if (e) {
        g + 1 < d.length && (d.length = g + 1);
        var l = d[d.length - 1];
        V <= ma(l) ? (l.v = l.v || [], l.v.push([H, E, v]), H = null) : H = new W(l, l.h && l.h.length, H, E);
        M(f) && G(f) < f.length && (d[g + 1] = H);
      } else {
        e = new W(!0, 0, H, E), d = [e];
      }
    }
    if (P(f) || f === +f) {
      k(3, f);
    } else {
      c = f[0];
      b = f[1];
      var t = 1, n = c, I;
      switch(c) {
        case 9:
        case 13:
        case 16:
          k(c, b);
          break;
        case 11:
          k(c);
          break;
        case 3:
        case 4:
        case 8:
        case 14:
        case 18:
          k(c, b);
          break;
        case 15:
          k(c);
          break;
        case 7:
          t = [];
          n = 2;
          for (I = f.length; n < I; ++n) {
            t[n - 2] = f[n];
          }
          k(c, b, I - 2 ? t : null);
          break;
        case 1:
        case 17:
          n = b, t = 2;
        default:
          P(n) && k(1 === t ? 1 : c, n, f[t]);
      }
    }
    return Infinity;
  });
  return e;
}
;function W(a, e, d, f) {
  if (a === !!a) {
    var c = null;
    this.l = a;
  } else {
    c = a, this.l = c.l;
  }
  this.j = c;
  this.m = d;
  c && (c.h || (c.h = []), a = c.h, 0 <= e && e < a.length ? a.splice(e, 0, this) : a.push(this));
  switch(d) {
    case 1:
    case 17:
      e = U(f), f = e[0];
    case 18:
      this.C = f;
  }
}
var Y = null;
function ma(a) {
  return a.l ? Y === a ? a.D ? na : a.F ? V : oa : Y.j === a ? pa : qa : ra;
}
W.prototype.remove = function() {
  if (V <= ma(this)) {
    return this.D = !0, null;
  }
  var a = this.j ? this.j.h.indexOf(this) : -1;
  0 <= a && (this.j.h.splice(a, 1), this.j = null);
};
W.prototype.wrap = function(a, e, d) {
  if (this.l) {
    this.o = this.o || [], this.o.push([a, e, d]), a = null;
  } else {
    if (this.j) {
      var f = (d = this.j) ? this.j.h.indexOf(this) : -1;
      a = new W(d, f, a, e);
    } else {
      a = null;
    }
  }
  sa(a, 0, [this]);
  return a;
};
function sa(a, e, d) {
  var f = a.h = a.h || [], c = f.length, b = d.length;
  for (e = e < c ? e : c; b;) {
    c = d[--b], 11 === c.m ? c.h && c.h.length && sa(a, e, c.h) : (c.remove(), f.splice(e, 0, c), c.j = a);
  }
}
var ra = 0, qa = 1, oa = 2, V = 3, na = 4, pa = 5;
function Z(a, e, d, f, c) {
  return ta(a, e, d, f, c);
}
function ta(a, e, d, f, c) {
  function b() {
    var p = "";
    E && (p = "</" + E.toLowerCase() + ">", E = "");
    return p;
  }
  var g = e || null, k = d || null, t = "function" === typeof f ? f : function() {
  };
  e = c || {};
  var n = !0 === e.quotAlways, I = !0 === e.useSingleQuot, H = e.instructionAttrPrefix || ":", E, v = [!1, null, !1, !1, !1], l = [], u = -1;
  if (M(a)) {
    return 9 !== a[0] && 11 !== a[0] && (a = [11, a]), C(a, function(p, y, D, z) {
      var K = !1;
      M(p) && (K = 0 < p.length - G(p));
      var q = v[5 * z], h = v[5 * z + 1], ea = v[5 * z + 2], Q = v[5 * z + 3];
      if (k) {
        var F = la(p);
        var J;
        Y = F;
        h && (h.h ? h.h.push(F) : h.h = [F]);
        if (M(k)) {
          for (h = 0, J = k.length; h < J; h += 2) {
            var r = k[h];
            var O = k[h + 1];
            if (r === +r) {
              if (r === F.m && !0 === O(F)) {
                break;
              }
            } else if ("*" === r) {
              if (!0 === O(F)) {
                break;
              }
            } else if (P(r) && r === F.C && !0 === O(F)) {
              break;
            }
          }
        } else {
          k(F);
        }
      } else {
        F = null;
      }
      h = p[0];
      r = p[1];
      J = 1;
      switch(R(p)) {
        case 9:
          l[++u] = r;
          break;
        case 3:
          M(p) || (r = p);
          l[++u] = b() + (Q ? r : S("" + r));
          return;
        case 4:
          l[++u] = "<![CDATA[" + S("" + r) + "]]\x3e";
          break;
        case 8:
          l[++u] = "\x3c!--" + S("" + r) + "--\x3e";
          break;
        case 13:
          l[++u] = b() + "\x3c!--[" + r + "]>";
          break;
        case 16:
          l[++u] = b() + "\x3c!--{" + r + "};";
          break;
        case 14:
          l[++u] = "\x3c!--[" + r + "]>\x3c!--\x3e";
          break;
        case 15:
          l[++u] = "\x3c!--<![endif]--\x3e";
          break;
        case 7:
          if (g) {
            var A = p[1];
            var w = p.slice(2), m;
            "function" === typeof g ? m = w.length ? g(A, w) : g(A) : g[A] && (m = w.length ? g[A].apply(null, w) : g[A]());
            void 0 !== m && null !== m && "" !== m && (P(m) || m === +m ? y.splice(D, 1, m) : M(m) && (11 === m[0] ? (m.shift(), m.unshift(D, 1), y.splice.apply(y, m)) : M(m[0]) ? (m.unshift(D, 1), y.splice.apply(y, m)) : y.splice(D, 1, m)));
            A = m;
            if (void 0 !== A && null !== A && "" !== A && (P(A) || A === +A || M(A))) {
              return -1;
            }
          }
          break;
        case 18:
          l[++u] = "</" + r + ">";
          break;
        case 17:
          A = !0;
        case 1:
          h === +h && (h = r, J = 2);
          h = U(h);
          y = h[1];
          D = h[2];
          h = h[0];
          p = p[J];
          "P" !== E || ia[h] ? E = "" : l[++u] = b();
          q = q || (q || aa[h] ? !0 : 0 < h.indexOf(":"));
          ea = !!da[h];
          Q = Q || !!ja[h];
          l[++u] = "<" + (q ? h : h.toLowerCase());
          y && (l[++u] = " id=" + T(y, I, q || n));
          D && (l[++u] = " class=" + T(D, I, q || n));
          if (!M(p) && N(p)) {
            y = ++u;
            D = "";
            for (w in p) {
              if (h = p[w], (m = 0 === w.indexOf(H)) && (w = w.substr(H.length)), "className" === w && (w = "class"), m && g && (h = ka(g, w, h, t)), !(null == h || x[w] && !1 === h || (D += " " + w, x[w] || !0 === h))) {
                if ("style" === w && N(h)) {
                  m = void 0;
                  J = h;
                  r = [];
                  O = -1;
                  for (m in J) {
                    h = J[m];
                    "0px" === h && (h = 0);
                    for (var ua = ++O, L, fa = [], ha = m.split(""), X = ha.length; X;) {
                      L = ha[--X], "A" <= L && "Z" >= L && (L = "-" + L.toLowerCase()), fa[X] = L;
                    }
                    r[ua] = fa.join("") + ":" + S("" + h);
                  }
                  h = r.join(";").substr(1);
                  if (!h) {
                    continue;
                  }
                }
                D += "=" + T(h, I, q || n);
              }
            }
            l[y] = D;
          }
          !q || K || A ? l[++u] = ">" : l[++u] = " />";
      }
      v[5 * z] = q;
      v[5 * z + 1] = F;
      v[5 * z + 2] = ea;
      v[5 * z + 3] = Q;
      v[5 * z + 4] = K;
    }, function(p, y, D, z) {
      y = v[5 * z];
      D = v[5 * z + 2];
      var K = v[5 * z + 4], q = p[0];
      5 * z + 5 < v.length && (v.length = 5 * z + 5);
      switch(R(p)) {
        case 13:
          l[++u] = b() + "<![endif]--\x3e";
          break;
        case 16:
          l[++u] = b() + "--\x3e";
          break;
        case 17:
          E = "";
          break;
        case 1:
          q === +q && (q = p[1]), q = U(q), q = q[0], !K && ba[q] ? E = "" : y && !K || ca[q] && (!D || "P" !== q) ? E = q : (l[++u] = "</" + (y ? q : q.toLowerCase()) + ">", E = "");
      }
    }), l.join("");
  }
}
;module.exports = Z;
Z.DOCUMENT_NODE = 9;
Z.DOCUMENT_FRAGMENT_NODE = 11;
Z.ELEMENT_NODE = 1;
Z.TEXT_NODE = 3;
Z.CDATA_SECTION = 4;
Z.PROCESSING_INSTRUCTION = 7;
Z.COMMENT_NODE = 8;
Z.COND_CMT_HIDE_LOWER = 13;
Z.COND_CMT_SHOW_LOWER_START = 14;
Z.COND_CMT_SHOW_LOWER_END = 15;
Z.NETSCAPE4_COND_CMT_HIDE_LOWER = 16;
Z.ELEMENT_START_TAG = 17;
Z.ELEMENT_END_TAG = 18;
Z.gulp = function(a, e, d, f) {
  const c = require("plugin-error");
  return require("through2").obj(function(b, g, k) {
    if (b.isNull()) {
      return k();
    }
    if (b.isStream()) {
      return this.emit("error", new c("json2html", "Streaming not supported")), k();
    }
    const t = "." + b.stem.split(".").pop();
    if (".json" === b.extname && [".html", ".htm", ".xhtml", ".php"].indexOf(t)) {
      try {
        const n = JSON.parse(b.contents.toString(g));
        if (M(n)) {
          const I = ta(n, a, e, d, f);
          b.stem = b.stem.substr(0, b.stem.length - t.length);
          b.extname = t;
          b.contents = Buffer.from(I);
        }
      } catch (n) {
        this.emit("error", new c("json2html", n));
      }
    }
    k(null, b);
  });
};

